<!--#region blocks -->
{% extends 'library_base.html' %}

{% block title %}PLATE SORTER {% if crate_id != 'None' %}{{ crate_id }}{% endif %}{% endblock %} 

{% block nav-title %}PLATE SORTER {% if crate_id != 'None' %}: {{ crate_id }}{% endif %}{% endblock %}

{% block content %}

<style>
  form{
    margin:0px; padding:0px; display:inline;
   }
</style>
<!--#endregion -->
<!--
crate_parent_id = {{ crate_parent_id }} <br>
crate_parent = {{ crate_parent }} <br>
crate_id = {{ crate_id }} <br><br>
display_unallocated = {{ display_unallocated }} <br>
display_stock = {{ display_stock }} <br>
display_searched_releases = {{ display_searched_releases }} <br>
member_id = {{ member.id }} <br>
search_catalog = {{ search_catalog }}
-->
<!--#region parent_crates -->
{% if display_searched_releases != 'display_searched_releases_plates' %}
{% if crate_parents|length >= 1 %}
{% if crate_parent_id != '' %}
<div style="padding-top:10px; display:flex; justify-content:space-between;align-items:center">
  <span style="font-size:2.5rem; font-weight:600;">Crate View</span>
  <div>
    {% if display_unallocated == 'display_unallocated_plates' %}
    <!--#region Hide Other {{ crate_id }} From Your Collection -->
    <form action="{% url 'plate_sorter' library.id %}" method="post" enctype="multipart/form-data" style="margin:0px; padding:0px; display:inline;">
      {% csrf_token %}
      <!--#region crate_parent_id -->
      <input name="crate_id"                              value="{{ crate_id }}"                      type="hidden">
      <input name="crate_parent_id"                       value="{{ crate_parent_id }}"               type="hidden">
      <!--#endregion -->
      <!--#region display_stock -->
      {% if display_stock %}
      <input name="display_stock"                         value="{{ display_stock }}"                 type="hidden">
      {% else %}
      <input name="display_stock"                         value="do_not_display_stock_plates"         type="hidden">
      {% endif %}
      <!--#endregion -->
      <!--#region display_unallocated -->
      <input name="display_unallocated"                   value="do_not_display_unallocated_plates"     type="hidden">
      <input name="member_id"                             value="{{ member.id }}"                       type="hidden">
      <input name="member_plate_id"                       value="{{ member_plate.id }}"                 type="hidden">
      <!--#region member_release_id -->
      {% if member_release %}
      <input name="member_release_id"                     value="{{ member_release.id }}"               type="hidden">
      {% else %}
      <input name="member_release_id"                     value="{{ member_release_id }}"               type="hidden">
      {% endif %}
      <!--#endregion -->
      <input name="previous_url"                          value="{{ previous_url }}"                    type="hidden">
      <input name="previous_vertical_location"            value="{{ previous_vertical_location }}"      type="hidden"     class="page_vertical_location">
      <input name="stock_item_id"                         value="{{ stock_item.id }}"                   type="hidden">               
      <!--#region vinyl_release_id -->
      {% if plate %}
      <input name="vinyl_release_id"                      value="{{ plate.related_release.id }}"        type="hidden">
      {% elif vinyl_release %}
      <input name="vinyl_release_id"                      value="{{ vinyl_release.id }}"                type="hidden">
      {% endif %}
      <!--#endregion -->
      <input type="submit"                                class="btn btn-sm btn-danger" value="Hide Other {{ crate_id }} From Your Collection">
    </form>
    <!--#endregion -->
    {% else %}
    <!--#region Show Other {{ crate_id }} From Your Collection -->
    <form action="{% url 'plate_sorter' library.id %}" method="post" enctype="multipart/form-data" style="margin:0px; padding:0px; display:inline;">
      {% csrf_token %}
      <!--#region variables -->
      <input name="crate_id"                              value="{{ crate_id }}"                      type="hidden">
      <!--#region crate_parent_id -->
      {% if crate_parent %}
      <input name="crate_parent_id"                       value="{{ crate_parent.id }}"               type="hidden">
      {% else %}
      <input name="crate_parent_id"                       value="{{ crate_parent_id }}"               type="hidden">
      {% endif %}
      <!--#endregion -->
      <!--#region display_stock -->
      {% if display_stock %}
      <input name="display_stock"                         value="{{ display_stock }}"                 type="hidden">
      {% else %}
      <input name="display_stock"                         value="do_not_display_stock_plates"         type="hidden">
      {% endif %}
      <!--#endregion -->
      <input name="display_unallocated"                   value="do_not_display_unallocated_plates"     type="hidden">
      <input name="member_id"                             value="{{ member.id }}"                       type="hidden">
      <input name="member_plate_id"                       value="{{ member_plate.id }}"                 type="hidden">
      <!--#region member_release_id -->
      {% if member_release %}
      <input name="member_release_id"                     value="{{ member_release.id }}"               type="hidden">
      {% else %}
      <input name="member_release_id"                     value="{{ member_release_id }}"               type="hidden">
      {% endif %}
      <!--#endregion -->
      <input name="previous_url"                          value="{{ previous_url }}"                    type="hidden">
      <input name="previous_vertical_location"            value="{{ previous_vertical_location }}"      type="hidden"     class="page_vertical_location">
      <input name="stock_item_id"                         value="{{ stock_item.id }}"                   type="hidden">               
      <!--#region vinyl_release_id -->
      {% if plate %}
      <input name="vinyl_release_id"                      value="{{ plate.related_release.id }}"        type="hidden">
      {% elif vinyl_release %}
      <input name="vinyl_release_id"                      value="{{ vinyl_release.id }}"                type="hidden">
      {% endif %}
      <!--#endregion -->
      <input name="display_unallocated"                   value="display_unallocated_plates"          type="hidden">
      <!--#endregion -->
      <input type="submit" class="btn btn-sm btn-secondary" value="Show Other {{ crate_id }} From Your Collection">
    </form>
    <!--#endregion -->
    {% endif %}
    {% if display_stock == 'show_stock_plates' %}
    <!--#region Hide Shop Stock -->
    <form action="{% url 'plate_sorter' library.id %}" method="post" enctype="multipart/form-data" style="margin:0px; padding:0px; display:inline;">
      {% csrf_token %}
      <!--#region variables -->
      <input name="crate_id"                              value="{{ crate_id }}"                      type="hidden">
      <!--#region crate_parent_id -->
      {% if crate_parent %}
      <input name="crate_parent_id"                       value="{{ crate_parent.id }}"               type="hidden">
      {% else %}
      <input name="crate_parent_id"                       value="{{ crate_parent_id }}"               type="hidden">
      {% endif %}
      <!--#endregion -->
      <input name="display_unallocated"                   value="do_not_display_unallocated_plates"     type="hidden">
      <input name="member_id"                             value="{{ member.id }}"                       type="hidden">
      <input name="member_plate_id"                       value="{{ member_plate.id }}"                 type="hidden">
      <!--#region member_release_id -->
      {% if member_release %}
      <input name="member_release_id"                     value="{{ member_release.id }}"               type="hidden">
      {% else %}
      <input name="member_release_id"                     value="{{ member_release_id }}"               type="hidden">
      {% endif %}
      <!--#endregion -->
      <input name="previous_url"                          value="{{ previous_url }}"                    type="hidden">
      <input name="previous_vertical_location"            value="{{ previous_vertical_location }}"      type="hidden"     class="page_vertical_location">
      <input name="stock_item_id"                         value="{{ stock_item.id }}"                   type="hidden">               
      <!--#region vinyl_release_id -->
      {% if plate %}
      <input name="vinyl_release_id"                      value="{{ plate.related_release.id }}"        type="hidden">
      {% elif vinyl_release %}
      <input name="vinyl_release_id"                      value="{{ vinyl_release.id }}"                type="hidden">
      {% endif %}
      <!--#endregion -->
      <input name="display_unallocated"                   value="display_unallocated_plates"            type="hidden">
      <input name="display_stock"                         value="do_not_show_stock_plates"              type="hidden">
      <!--#endregion -->
      <input type="submit"                                value="Hide Shop Stock"                       class="btn btn-sm btn-danger" style="width:160px">
    </form>
    <!--#endregion -->
    {% else %}
    <!--#region Display Shop Stock -->
    <form action="{% url 'plate_sorter' library.id %}" method="post" enctype="multipart/form-data" style="margin:0px; padding:0px; display:inline;">
      {% csrf_token %}
      <!--#region variables -->
      <input name="crate_id"                              value="{{ crate_id }}"                      type="hidden">
      <!--#region crate_parent_id -->
      {% if crate_parent %}
      <input name="crate_parent_id"                       value="{{ crate_parent.id }}"               type="hidden">
      {% else %}
      <input name="crate_parent_id"                       value="{{ crate_parent_id }}"               type="hidden">
      {% endif %}
      <!--#endregion -->
      <input name="display_unallocated"                   value="do_not_display_unallocated_plates"     type="hidden">
      <input name="member_id"                             value="{{ member.id }}"                       type="hidden">
      <input name="member_plate_id"                       value="{{ member_plate.id }}"                 type="hidden">
      <!--#region member_release_id -->
      {% if member_release %}
      <input name="member_release_id"                     value="{{ member_release.id }}"               type="hidden">
      {% else %}
      <input name="member_release_id"                     value="{{ member_release_id }}"               type="hidden">
      {% endif %}
      <!--#endregion -->
      <input name="previous_url"                          value="{{ previous_url }}"                    type="hidden">
      <input name="previous_vertical_location"            value="{{ previous_vertical_location }}"      type="hidden"     class="page_vertical_location">
      <input name="stock_item_id"                         value="{{ stock_item.id }}"                   type="hidden">               
      <!--#region vinyl_release_id -->
      {% if plate %}
      <input name="vinyl_release_id"                      value="{{ plate.related_release.id }}"        type="hidden">
      {% elif vinyl_release %}
      <input name="vinyl_release_id"                      value="{{ vinyl_release.id }}"                type="hidden">
      {% endif %}
      <!--#endregion -->
      <input name="display_unallocated"                   value="display_unallocated_plates"          type="hidden">
      <!--#endregion -->
      <input name="display_stock"                         value="show_stock_plates"                   type="hidden">
      <input type="submit"                                value="Display Shop Stock"                  class="btn btn-sm btn-secondary" style="width:160px">
    </form>
    <!--#endregion -->
    {% endif %}
  </div>
</div>
<div style="border: 0.1px solid black; padding:10px; margin-top:10px; font-size:0.9rem">
{% else %}
<div style="border: 0.1px solid black; padding:10px; margin-top:30px; font-size:0.9rem">
{% endif %}

<!--#region crates -->
{% for i in crate_parents %}
<form action="{% url 'plate_sorter' library.id %}" method="post" enctype="multipart/form-data" style="margin:0px; padding:0px; display:inline;">
  {% csrf_token %}
  <!--#region variables -->
  <input name="display_unallocated"                   value="do_not_display_unallocated_plates"     type="hidden">
  <input name="member_id"                             value="{{ member.id }}"                       type="hidden">
  <input name="member_plate_id"                       value="{{ member_plate.id }}"                 type="hidden">
  <!--#region member_release_id -->
  {% if member_release %}
  <input name="member_release_id"                     value="{{ member_release.id }}"               type="hidden">
  {% else %}
  <input name="member_release_id"                     value="{{ member_release_id }}"               type="hidden">
  {% endif %}
  <!--#endregion -->
  <input name="previous_url"                          value="{{ previous_url }}"                    type="hidden">
  <input name="previous_vertical_location"            value="{{ previous_vertical_location }}"      type="hidden"     class="page_vertical_location">
  <input name="stock_item_id"                         value="{{ stock_item.id }}"                   type="hidden">               
  <!--#region vinyl_release_id -->
  {% if plate %}
  <input name="vinyl_release_id"                      value="{{ plate.related_release.id }}"        type="hidden">
  {% elif vinyl_release %}
  <input name="vinyl_release_id"                      value="{{ vinyl_release.id }}"                type="hidden">
  {% endif %}
  <!--#endregion -->
  <!--#endregion -->
  <input name="crate_id"                               value="{{ i.crate_id }}"                     type="hidden">
  <input name="crate_parent_id"                        value="{{ i.id }}"                           type="hidden">
  <input name="display_unallocated"                    value="do_not_display_unallocated_plates"    type="hidden">
  <input type="submit"                                 value="{{ i.crate_id }}"                     class="btn btn-sm {% if i.crate_id == crate_id and crate_parent_id != '' %} btn-success {% else %}{% endif %}">
</form>
{% endfor %}
<!--#endregion -->
{% if crate_parent_id != '' %}
<!--#region exit crate view -->
<form action="{% url 'plate_sorter' library.id %}" method="post"  enctype="multipart/form-data" style="margin:0px; padding:0px; display:inline;">
  {% csrf_token %}
  <!--#region variables -->
  <input name="crate_id"                              value="{{ i.crate_id }}"                      type="hidden">
  <input name="crate_parent_id"                       type="hidden" value="">
  <input name="display_stock"                         value="do_not_show_stock_plates"              type="hidden">
  <input name="display_unallocated"                   value="do_not_display_unallocated_plates"     type="hidden">
  <input name="member_id"                             value="{{ member.id }}"                       type="hidden">
  <input name="member_plate_id"                       value="{{ member_plate.id }}"                 type="hidden">
  <!--#region member_release_id -->
  {% if member_release %}
  <input name="member_release_id"                     value="{{ member_release.id }}"               type="hidden">
  {% else %}
  <input name="member_release_id"                     value="{{ member_release_id }}"               type="hidden">
  {% endif %}
  <!--#endregion -->
  <input name="previous_url"                          value="{{ previous_url }}"                    type="hidden">
  <input name="previous_vertical_location"            value="{{ previous_vertical_location }}"      type="hidden"     class="page_vertical_location">
  <input name="stock_item_id"                         value="{{ stock_item.id }}"                   type="hidden">               
  <!--#region vinyl_release_id -->
  {% if plate %}
  <input name="vinyl_release_id"                      value="{{ plate.related_release.id }}"        type="hidden">
  {% elif vinyl_release %}
  <input name="vinyl_release_id"                      value="{{ vinyl_release.id }}"                type="hidden">
  {% endif %}
  <!--#endregion -->
  <!--#endregion -->
  
  
  <input type="submit"                                value="Exit Crate View"                       class="btn btn-sm btn-danger">
</form>
<!--#endregion -->
{% endif %}
</div>
{% endif %}
{% endif %}
<!--#endregion -->

<!--#region member plates crate_id's links -->
{% if crate_parent_id == '' %}
{% if display_searched_releases != 'display_searched_releases_plates' %}
<!--#region your plates header-->
<div style="display:flex; margin-top:10px; justify-content:space-between;align-items:center">
  <div style="font-size:2.5rem; font-weight:600">Your Plates by Crate ID</div>
  <span>
  {% if crate_id != 'None' %}
  {% if display_stock == 'show_stock_plates' %}
  <!-- Hide Shop Stock -->
  <form action="{% url 'plate_sorter' library.id %}" method="post"  enctype="multipart/form-data" style="margin:0px; padding:0px; display:inline;">
    {% csrf_token %}
    {% include 'form_variables.html' %}
    <input name="display_stock"                       type=hidden value='do_not_show_stock_plates' >
    <input type="submit" class="btn btn-sm btn-danger" style="width:160px" value="Hide Shop Stock">
    
  </form>
  {% elif display_stock == 'do_not_show_stock_plates' %}
  <!-- Display Shop Stock -->
  <form action="{% url 'plate_sorter' library.id %}" method="post"  enctype="multipart/form-data" style="margin:0px; padding:0px; display:inline;">
    {% csrf_token %}
    <!--#region variables -->
    <input name="crate_id"                              value="{{ crate_id }}"                      type="hidden">
    <!--#region crate_parent_id -->
    {% if crate_parent %}
    <input name="crate_parent_id"                       value="{{ crate_parent.id }}"               type="hidden">
    {% else %}
    <input name="crate_parent_id"                       value="{{ crate_parent_id }}"               type="hidden">
    {% endif %}
    <!--#endregion -->
    <input name="display_stock"                         value="show_stock_plates"                     type="hidden">
    <input name="display_unallocated"                   value="do_not_display_unallocated_plates"     type="hidden">
    <input name="member_id"                             value="{{ member.id }}"                       type="hidden">
    <input name="member_plate_id"                       value="{{ member_plate.id }}"                 type="hidden">
    <!--#region member_release_id -->
    {% if member_release %}
    <input name="member_release_id"                     value="{{ member_release.id }}"               type="hidden">
    {% else %}
    <input name="member_release_id"                     value="{{ member_release_id }}"               type="hidden">
    {% endif %}
    <!--#endregion -->
    <input name="previous_url"                          value="{{ previous_url }}"                    type="hidden">
    <input name="previous_vertical_location"            value="{{ previous_vertical_location }}"      type="hidden"     class="page_vertical_location">
    <input name="stock_item_id"                         value="{{ stock_item.id }}"                   type="hidden">               
    <!--#region vinyl_release_id -->
    {% if plate %}
    <input name="vinyl_release_id"                      value="{{ plate.related_release.id }}"        type="hidden">
    {% elif vinyl_release %}
    <input name="vinyl_release_id"                      value="{{ vinyl_release.id }}"                type="hidden">
    {% endif %}
    <!--#endregion -->
    <input type="submit"                                value="Display Shop Stock"                    class="btn btn-sm btn-secondary" style="width:160px;">
    <!--#endregion -->
  </form>
  <!--#endregion -->
  </form>
  {% endif %}
  {% endif %}
  <!--! Display External Release Search -->
  <form action="{% url 'plate_sorter' library.id %}" method="post"  enctype="multipart/form-data" style="margin:0px; padding:0px; display:inline;">
    {% csrf_token %}
    {% include 'form_variables.html' %}
    <input name="display_searched_releases"                 type=hidden value='display_searched_releases_plates' >
    <input name="display_stock"                             type=hidden value='do_not_show_stock_plates' >
    <input name="display_unallocated"                       type=hidden value='do_not_display_unallocated_plates' >
    <input type="submit" class="btn btn-sm btn-secondary" style="padding-left:10px; padding-right:10px" value="Search for External Release">
  </form>
  
</span>
</div>
<!--#endregion -->

<!--#region plates by crate_id -->
<div style="border: 0.1px solid black; padding:10px; margin-top:20px; font-size:0.9rem">
{% for i in member_plate_crate_ids %}
{% if i == crate_id and display_allocated == display_unallocated_plates %}
<!--#region stop showing crate_id plates -->
<form action="{% url 'plate_sorter' library.id %}" method="post" enctype="multipart/form-data">
  {% csrf_token %}
  <!--#region variables -->
  <input name="crate_id"                              value="None"                                  type="hidden">
  <input name="crate_parent_id"                       value="None"                                  type="hidden">
  <input name="display_stock"                         value="show_stock_plates"                     type="hidden">
  <input name="display_unallocated"                   value="display_unallocated_plates"     type="hidden">
  <input name="member_id"                             value="{{ member.id }}"                       type="hidden">
  <input name="member_plate_id"                       value="{{ member_plate.id }}"                 type="hidden">
  <!--#region member_release_id -->
  {% if member_release %}
  <input name="member_release_id"                     value="{{ member_release.id }}"               type="hidden">
  {% else %}
  <input name="member_release_id"                     value="{{ member_release_id }}"               type="hidden">
  {% endif %}
  <!--#endregion -->
  <input name="previous_url"                          value="{{ previous_url }}"                    type="hidden">
  <input name="previous_vertical_location"            value="{{ previous_vertical_location }}"      type="hidden"     class="page_vertical_location">
  <input name="stock_item_id"                         value="{{ stock_item.id }}"                   type="hidden">               
  <!--#region vinyl_release_id -->
  {% if plate %}
  <input name="vinyl_release_id"                      value="{{ plate.related_release.id }}"        type="hidden">
  {% elif vinyl_release %}
  <input name="vinyl_release_id"                      value="{{ vinyl_release.id }}"                type="hidden">
  {% endif %}
  <!--#endregion -->
  <input type="submit"                                value="{{ i }}"                               class="btn btn-sm" style="font-size:2rem; color:green">
</form>
<!--#endregion -->
{% elif i == crate_id and display_allocated == do_not_display_unallocated_plates %}
<!--#region show crate_id plates -->
<form action="{% url 'plate_sorter' library.id %}" method="post" enctype="multipart/form-data">
  {% csrf_token %}

  <input name="member_id"                             value="{{ member.id }}"                       type="hidden">
  <input name="member_plate_id"                       value="{{ member_plate.id }}"                 type="hidden">
  <input name="previous_url"                          value="{{ previous_url }}"                    type="hidden">
  <input name="crate_id"                              value="{{ crate_id }}"                        type="hidden">
  <input name="previous_vertical_location"            value="{{ previous_vertical_location }}"      type="hidden"     class="page_vertical_location">
  <input name="stock_item_id"                         value="{{ stock_item.id }}"                  type="hidden">
  <input name="display_unallocated"                   value="display_unallocated_plates"          type="hidden">
  <input type="submit" class="btn btn-sm" value="{{ i }}">
</form>
<!--#endregion -->
{% else %}
<!--#region show different crate_id plates-->
<form action="{% url 'plate_sorter' library.id %}" method="post" enctype="multipart/form-data">
  {% csrf_token %}
  <input name="member_id"                             value="{{ member.id }}"                       type="hidden">
  <input name="member_plate_id"                       value="{{ member_plate.id }}"                 type="hidden">
  <input name="previous_url"                          value="{{ previous_url }}"                    type="hidden">
  <input name="crate_id"                              value="{{ crate_id }}"                        type="hidden">
  <input name="previous_vertical_location"            value="{{ previous_vertical_location }}"      type="hidden"     class="page_vertical_location">
  <input name="stock_item_id"                         value="{{ stock_item.id }}"                  type="hidden">
  <input name="crate_id"                              type="hidden" value="{{ i }}" >
  <input name="display_unallocated"                   value="display_unallocated_plates"          type="hidden">
  <input type="submit" class="btn btn-sm" value="{{ i }}">
</form>
<!--#endregion -->
{% endif %}
{% endfor %}
</div>
<!--#endregion -->

{% endif %}
{% endif %}
<!--#endregion -->

<!--#region search for other plates -->
{% if display_searched_releases == 'display_searched_releases_plates' %}
<div style="display:flex; margin-top:10px; justify-content:space-between;align-items:center">
<div style="font-size:2.5rem; font-weight:600; margin-top:10px; ">External Release Search</div>
<!--#region do_not_display_searched_releases_plates -->
<form action="{% url 'plate_sorter' library.id %}" method="post"  enctype="multipart/form-data" style="margin:0px; padding:0px; display:inline;">
  {% csrf_token %}
  {% include 'form_variables.html' %}
  <input name="crate_id"                                  type=hidden value='None'>
  <input name="display_searched_releases"                 type=hidden value='do_not_display_searched_releases_plates'>
  <input type="submit" class="btn btn-sm btn-danger" style="padding-left:10px; padding-right:10px" value="Exit External Release Search">
</form>
<!--#endregion -->
</div>
<!--#region search -->
<div style="display:flex; justify-content:space-between; margin-top:20px; font-size:0.9rem; width:100%; align-items:middle">
  <form action="{% url 'plate_sorter' library.id %}" method="post" enctype="multipart/form-data" style="width:100%; vertical-align:center">
    {% csrf_token %}
    {% include 'form_variables.html' %}
      <!--#region search_artist -->
      {% if search_artist and search_artist != 'None' %}
      <input id="search_artist" type="text"  name="search_artist" value="{{ search_artist }}" style="border:3px solid green; width:24%">
      {% else %}
      <input id="search_artist" type="text" placeholder="Artist..." name="search_artist" style="width:24%">
      {% endif %}
      <!--#endregion -->
      <!--#region search_title -->
      {% if search_title  and search_title != 'None' %}
      <input id="search_title" type="text" name="search_title"  value="{{ search_title }}" style="border:3px solid green; width:24%">
      {% else %}
      <input id="search_title" type="text" placeholder="Title..." name="search_title" style="width:24%">
      {% endif %}
      <!--#endregion -->
      <!--#region search_label -->
      {% if search_label  and search_label != 'None' %}
      <input id="search_label" type="text" name="search_label"  value="{{ search_label }}" style="border:3px solid green; width:24%">
      {% else %}
      <input id="search_label" type="text" placeholder="Label..." name="search_label" style="width:24%">
      {% endif %}
      <!--#endregion -->
      <!--#region search_catalog -->
      {% if search_catalog and search_artist != 'None' %}
      <input id="search_catalog" type="text" name="search_catalog" value="{{ search_catalog }}"  style="border:3px solid green; width:24%">
      {% else %}
      <input id="search_catalog" type="text" placeholder="Catalog..." name="search_catalog" style="width:24%">
      {% endif %}
      <!--#endregion -->
      {% if has_been_triggered and has_been_triggered != 'has_been_triggered' %}
      <input type="hidden" name="has_been_triggered" value="has_been_triggered">
      <button type="submit" class="btn btn-secondary btn-sm" id="auto_clicked_member_adds_stock_item_button" style="height:30px; font-size:0.9rem; "><i class="fas fa-search"></i></button>
      {% else %}
      <button type="submit" class="btn btn-secondary btn-sm" style="height:30px; font-size:0.9rem; "><i class="fas fa-search"></i></button>
      {% endif %}
  </form>
  <form action="{% url 'plate_sorter' library.id %}" method="post"  enctype="multipart/form-data" style="margin:0px; padding:0px; display:inline;">
    {% csrf_token %}
    {% include 'form_variables.html' %}
    <input name="display_searched_releases"                 type=hidden value='display_searched_releases_plates'>
    <input name="display_stock"                             type=hidden value='do_not_show_stock_plates'>
    <input name="display_unallocated"                       type=hidden value='do_not_display_unallocated_plates'>
    <input type="submit" class="btn btn-sm btn-secondary" style="padding-left:10px; padding-right:10px" value="Reset Search">
  </form>
</div>
{% endif %}

<!--#endregion -->

<!--#region plates -->
{% for vinyl_plate_identifier, member_plate, plate, stock_item, release_title_long, vinyl_tracks_crate_ids in all_plates %}
<div style="border: 1px solid black; margin:30px 0px; padding:10px; font-size:0.9rem">
  <!--#region plate header -->
  <span style="display:flex; justify-content:space-between; align-items:center; background-color:white; padding-left:10px;padding-right:10px">
    <!--#region plate artwork and link --> <!--###-->
    <span style="display:flex; align-items:center">
      <!--#region artwork -->
      {% if plate.related_release.artwork_small %}
      <span>
        <img src="{{ plate.related_release.artwork_small.url }}" width="30" height="30">
      </span>
      {% else %}
      <span style="text-align:center; font-size: 0.5rem;">
        No image
      </span>
      {% endif %}
      <!--#endregion -->
      {% include 'vinyl_release_form.html' %}
    </span>
    <!--#endregion -->
    {% if plate.related_release.distributor.active == True and plate.related_release.stock_estimation >= 1 and stock_item == None and member_plate == None %}
    <!--#region create stock item -->
    <div style="display:inline-block">
      {% include 'member_release_create_form.html' %}
      <!--#region         Stock Item Create & Add to Cart               -->
      {% include 'stock_item_create_and_add_to_cart_form.html' %}
      <!--#endregion -->
    </div>
    <!--endregion -->
    {% elif member_plate.member_release.status == in_coming %}
    <!--#region release incoming -->
    <div style="display:inline-block">
      <span style="font-size:1.6rem; margin-right:10px; color:gray">Release Incoming</span>
      {% if member_plate.member_release.order_request_item.stockpiled == True %}
      <span>In Stockpile</span>
      {% elif member_plate.member_release.order_request_item.ordered == True %}
      <span>Ordered</span>
      {% else %}
      <span>Processing Order</span>
      {% endif %}
    </div>
    <!--#endregion -->
    {% elif member_plate != None %}
    <!--#region           MEMBER PLATE                                  -->
    <span style="display:block">
      <!--#region plate location -->
      {% if member_plate.crate_parent != None %}
      <span style="display:flex; align-items:baseline">
        <!--#region location -->
        <span style="margin-right:5px">Location:</span>
        <span style="display:flex; align-items:center; justify-content:space-between">
          <!--#region crate parent crate_id -->
          {% if member_plate.crate_parent.crate_id == crate_id %}
          <span style="font-size:1.5rem;color:green">{{ member_plate.crate_parent.crate_id }}</span>
          {% else %}
          <span style="font-size:1.5rem">{{ member_plate.crate_parent.crate_id }}</span>
          {% endif %}
          <!--#endregion -->
          <!--#region crate_parent_desired_option -->
          {% if member_plate.crate_parent_desired_option == True and member_plate.desired_crate_parent_option_crate_parent == member_plate.crate_parent %}
          {% if member_plate.crate_parent.crate_id == crate_id %}
          <span style="margin-left:5px; color:green"><i class="fas fa-check"></i></span>
          {% else %}
          <span style="margin-left:5px"><i class="fas fa-check"></i></span>
          {% endif %}
          {% else %}
          {% include 'member_plate_crate_parent_set.html' %}
          {% endif %}
          <!--#endregion -->
        </span>
        <!--#endregion -->
      </span>
      {% endif %}
      <!--#endregion -->
      {% include 'move_plate_form.html' %}
    </span>
    <!--#endregion MEMBER PLATE-->
    {% elif stock_item in items %}
    <!--#region           Release In Cart -> Go To Shopping Cart        -->
    <span>
    <span>
    {% include 'go_to_shopping_cart_form.html' %}
    </span>
    <!--#endregion -->
    {% include 'remove_vinyl_release_from_shopping_cart_form.html' %}
    </span>
    {% else %}
    <span>
      {% include 'member_release_create_form.html' %}
      {% if stock_item and member_plate == None %}
      {% include 'add_release_to_cart_form.html' %}
      {% endif %}
    </span>
    <!--#endregion -->
    {% endif %}
  </span>
  <!--#endregion -->
  <!--#region tracks -->
  <table class="table table-borderless table-sm" style="margin-top:10px; background-color:white">
    <thead>
      <tr style="background-color: white">
      <th class="text-center" style="width:60px"></th>
      <th style="width:300px">Artist</th>
      <th style="width:300px">Title</th>
      <th style="width:200px">Genre</th>
      <th style="width:150px">Vibe</th>
      <th class="text-center" style="width:100px">Energy</th>
      <th style="width:200px"></th>
      </tr>
    </thead>
    {% for track in plate.related_vinyl_track.all %}
    <tbody>
      {% if track.crate_id == crate_id %}
      <tr style="color:green;">
      {% else %}
      <tr>
      {% endif %}
        <td class="text-center" style="width:60px">{{track.index}}.</td>
        <td>{{track.artist}}</td>
        <td>{{track.title}}</td>
        <!--#region genre / vibe / energy_level -->
        {% if track.genre != '-' and track.vibe != '-' and track.energy_level != '-' %}
        <!--#region track has this crate_id -->
        <td>{{track.genre}}</td>
        <td>{{track.vibe}}</td>
        <td class="text-center">{{track.energy_level}}</td>
        <!--#endregion -->
        {% else %}
        <!--#region crate_id not complete -->
        <td style="color:red">{{track.genre}}</td>
        <td style="color:red">{{track.vibe}}</td>
        <td style="color:red" class="text-center">{{track.energy_level}}</td>
        <!--#endregion -->
        {% endif %}
        <!--#endregion -->
        {% if track.audio %}
        <!--#region listen -->
        <td>
          <audio controls controlsList="noplaybackrate nodownload" style="width:200px; height:25px; background-color:whitesmoke" preload="none">
            <source src="{{ track.audio.url }}" type="audio/mp3" class='audios'>
          </audio>
        </td>
        {% else %}
        <td class="text-center">
          No Audio
        </td>
        <!--#endregion -->
        {% endif %}
      </tr>
    </tbody>   
    {% endfor %}
  </table>
  <!--#endregion -->
</div>
{% endfor %}
<!--#endregion -->

<!--#region java -->
<!--#region play one audio track at once -->
<script>
  var previousAudio;
  document.addEventListener('play', function (e) {
    if (previousAudio && previousAudio != e.target) {
      previousAudio.pause();
    }
    previousAudio = e.target;
  }, true);
</script>
<!--#endregion -->
<!--#region auto-scroll-window -->
<input type="hidden" id="page_vertical_location" value="{{ previous_vertical_location }}">
<button onclick="scrollWin()" id="auto_clicked_button" class="btn btn-sm"></button>
<script>
function scrollWin() {
  let height = document.getElementById('page_vertical_location').value;
  window.scrollTo(0, height);
}
</script>
<script>
  document.getElementById('auto_clicked_button').click();
</script>
<!--#endregion -->
<!--#region get current scroll height -->

<!--#endregion -->
<!--#region search_catalog = search_catalog etc.-->

<script>
  window.addEventListener("load", myInit, true); function myInit(){
    let search_artist_from_form_header = document.getElementById('search_artist').value;
    const search_artists = document.querySelectorAll('.search_artist');
    search_artists.forEach(searchArtist => {
      searchArtist.value = search_artist_from_form_header
    })
    let search_title_from_form_header = document.getElementById('search_title').value;
    const search_titles = document.querySelectorAll('.search_title');
    search_titles.forEach(searchTitle => {
      searchTitle.value = search_title_from_form_header
    })
    let search_label_from_form_header = document.getElementById('search_label').value;
    const search_labels = document.querySelectorAll('.search_label');
    search_labels.forEach(searchLabel => {
      searchLabel.value = search_label_from_form_header
    });

    let search_catalog_from_form_header = document.getElementById('search_catalog').value;
    const search_catalogs = document.querySelectorAll('.search_catalog');
    search_catalogs.forEach(searchCatalog => {
      searchCatalog.value = search_catalog_from_form_header
    });
    window.addEventListener("scroll", (event) => {
      let scroll = this.scrollY;
      const page_vertical_location_elements = document.querySelectorAll('.page_vertical_location');
      page_vertical_location_elements.forEach(plate => {
        plate.value = scroll
      });
    });
  }
</script>

<!--#endregion -->
<!--#region if search_catalog and search_catalog != 'None' and has_been_triggered != 'has_been_triggered' -->
{% if has_been_triggered and has_been_triggered != 'has_been_triggered' %}
<script>
  document.getElementById('auto_clicked_member_adds_stock_item_button').click();
</script>
{% endif %}
<!--#endregion -->
<!--#endregion -->
<!--#endregion -->
{% endblock %}