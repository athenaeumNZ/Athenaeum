<!DOCTYPE html>
<html lang="en">
  <head>
      <meta charset="UTF-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
      <title>INV-{{ order.id|stringformat:"06d" }} {{ order.member }}</title>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/js/all.min.js"></script>
  </head>
  <body style="background-color:whitesmoke">
    <div style="left:0; position:relative; width:210mm; height:297mm; margin: 0mm auto; background-color:white; padding:0mm 5mm">
      
      <span style="display:flex; justify-content:space-between; text-transform:uppercase">
        <span>
          <span style="font-size:4rem"><strong>{{ order.library.name }}</strong></span><br>
          <span style="font-size:1.5rem">Tax Invoice: INV-{{ order.id|stringformat:"06d" }}</span><br>
          {% if order.paid == True %}
            <span style="color:green">
              Invoice Paid
            </span>
          {% else %}
            <span style="color:red">
              Invoice Not Paid
            </span>
          {% endif %}
        </span>
        <span class="d-print-none" style="margin:10mm 5mm 0mm 0mm; display:flex">
          <span>
            {% if order.paid != True %}
              <a href="{% url 'member_invoices' library.id order.member.id %}" id="auto_clicked_button" class="btn btn-secondary btn-sm" style="text-transform:none" onclick="return confirm('If you have not paid this invoice yet we highly recommend paying it before closing this page. Orders can not be processed until the invoice is paid.')">Close</a>
            {% else %}
              {% if library.librarian == user %}
                <a href="{% url 'vinyl_shop_members_invoices' library.id order.member.id %}" id="auto_clicked_button" class="btn btn-secondary btn-sm" style="text-transform:none">Return to Invoices</a>
              {% else %}
                <a href="{% url 'member_invoices' library.id order.member.id %}" id="auto_clicked_button" class="btn btn-secondary btn-sm" style="text-transform:none">Return to Invoices</a>
              {% endif %}            
            {% endif %}
          </span>
          <span style="display:flex">
          {% if order.paid != True and library.librarian == user %}
            <form action="{% url 'invoice_pay_submission' library.id order.id %}" method="post" style="margin-left:5px">
              {% csrf_token %}
              <button type="submit" class="btn btn-danger btn-sm">Paid</button>
            </form>
          {% endif %}
          {% if order.on_order != True and library.librarian == user %}
            <form action="{% url 'invoice_order_items_submission' library.id order.id %}" method="post" style="margin-left:5px">
              {% csrf_token %}
              <button type="submit" class="btn btn-danger btn-sm">Ordered</button>
            </form>
          {% endif %}
          {% if order.cashbook_entry_added != True and library.librarian == user %}
            <form action="{% url  'invoice_cashbook_entry_add_submission' library.id order.id %}" method="post" style="margin-left:5px">
              {% csrf_token %}
              <button type="submit" class="btn btn-danger btn-sm">Add Cashbook Entry</button>
            </form>
          {% endif %}
          </span>
          
        </span>
        <span style="margin:10mm 5mm 0mm 0mm;">{{ order.created|date:"d M Y" }}</span>
      </span>

      <span style="display:flex; justify-content:space-around; margin-top:5mm; font-size:0.8rem">
        <span>
          <span style="font-style: italic;" class="text-muted">To:</span><br>
          {{ order.member }}<br>
          {{ order.member.address.street_number}} {{ order.member.address.street_name }}<br>
          {{ order.member.address.suburb}}<br>
          {{ order.member.address.city }} {{ order.member.address.post_code }}<br>
          {{ order.member.address.country }}
        </span>

        <span style="width:40%">
          <span style="font-style: italic;" class="text-muted">From:</span><br>
          {{ library }}<br>
          {{ library.street_number}} {{ library.street_name }}<br>
          {{ library.suburb}}<br>
          {{ library.city }} {{ library.post_code }}<br>
          {{ library.country }}<br>
          GST Number: <strong style="color:blue">I don't have a GST number yet. Also, I am unsure if I am registering for GST. Any questions please ask.</strong>
        </span>

      </span>
      <span style="margin-top:10mm; display:flex; justify-content:center">
        <div style="width:100%">
          <table class="table" style="font-size:0.7rem">
            <thead>
              <tr>
                <th class="d-print-none text-center">Stock</th>
                <th class="d-print-none text-center">Ordered</th>
                <th>Catalog</th>
                <th></th>
                <th>Artist</th>
                <th>Title</th>
                <th>Label</th>
                <th style="text-align:center">Q</th>
                <th style="text-align:center">Item Cost</th>
                <th style="text-align:center">Sub Total</th>  
              </tr>
            </thead>

            <tbody>
              {% for item in order_items %}
                <tr>
                  <td class="d-print-none" style="text-align:center">
                    {% if item.vinyl_release.id in members_collection and item.ordered == False %}
                      <span><a href="{% url 'invoice_order_get_item_found_in_stock_submission' library.id order.id item.id %}" style="color:blue;" onclick="return confirm('Move stock to members Stockpile crate before clicking OK!')">S</a></span>&#160;
                      <span><a href="{% url 'invoice_order_get_item_found_in_on_order_submission' library.id order.id item.id %}" style="color:green;" onclick="return confirm('Assign Incoming Stock?')">I</a></span>
                    {% endif %}
                  </td>
                  {% if item.ordered %}
                    <td style="color:green; font-size:0.5rem; text-align:center"  class="d-print-none"><i class="fas fa-check"></i></td>
                  {% else %}
                    <td style="text-align:center"  class="d-print-none"><a href="{% url 'invoice_order_item_submission' library.id order.id item.id %}" style="color:red"><i class="fas fa-times" style="font-size:0.5rem"></i></a></td>
                  {% endif %}
                  <td>
                  {{ item.vinyl_release.catalog_number }}
                  <span class="d-print-none">
                    {% if order.on_order == False %}
                      <span style="color:red">
                        {{ item.vinyl_release.supplier.distributor_code }}
                      </span>
                    {% endif %}
                  </span>
                  {% if item.vinyl_release.plate_count == 1 %}
                    <td class="text-center">{{ item.vinyl_release.plate_size }}</td>
                  {% else %}
                    <td class="text-center">{{ item.vinyl_release.plate_count }}x{{ item.vinyl_release.plate_size }}</td>
                  {% endif %}
                  </td>
                  <td>{{ item.vinyl_release.artist }}</td>
                  <td>{{ item.vinyl_release.release_title }}</td>
                  <td>{{ item.vinyl_release.label }}</td>
                  <td style="text-align:center"><a href="{% url 'invoice_item_update' library.id order.id item.id %}" style="color:black; text-decoration:none">{{ item.quantity }}</a></td>
                  <td style="text-align:center; color:gray">${{ item.price }}</td>
                  <td style="text-align:center">${{ item.get_cost }}</td>
                </tr>
              {% endfor %}
              <tr>
                <td class="d-print-none" colspan="2"></td>
                <td style="text-align:right; font-size:0.7rem; width:20mm" colspan="7">GST incl.</td>
                <td style="text-align:center; font-size:0.7rem">${{ order.get_gst|floatformat:"2" }}</strong></td>
              </tr>
              {% if member.account_credit != 0.00 and order.get_total_cost != 0.00 and order.credit_used == 0.00 %}
                {% if member.account_credit > 0 %}
                  <tr style="color:green">
                {% else %}
                  <tr style="color:red">
                {% endif %}
                  <td colspan="6">
                    <span style="float:right">
                      <a href="{% url 'invoice_use_credit_submission' library.id order.id %}" class="btn btn-danger btn-sm">Apply Credit</a>
                    </span>
                  </td>
                  <td style="text-align:right; font-size:0.7rem; width:20mm; vertical-align:middle">Credit</td>
                  <td style="text-align:center; font-size:0.7rem; vertical-align:middle">${{ member.account_credit }}</strong></td>
                </tr>
              {% endif %}
              <tr>
                <td class="d-print-none" colspan="2"></td>
                <td style="text-align:right; font-size:1rem; width:20mm" colspan="7">Total</td>
                <td style="text-align:center; font-size:1rem"><strong style="color:blue">${{ order.get_total_cost }}</strong></td>
              </tr>
              {% if order.credit_used != 0.00 %}
                <tr>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td style="text-align:right; font-size:0.7rem; width:20mm; vertical-align:middle">Credit Used</td>
                  <td style="text-align:right; font-size:0.7rem; vertical-align:middle">${{ order.credit_used }}</strong></td>
                </tr>
              {% endif %}
            </tbody> 
          </table>

          {% if member.no_mark_up == True and order.mark_up_removed == False %}
            <span style="display:flex; justify-content:right; padding-top:5mm" class="d-print-none">
              <a href="{% url 'invoice_remove_mark_up_submission' library.id order.id %}" class="btn btn-danger btn-sm" style="width:300px">Remove Mark Up</a>
            </span>
          {% endif %}
          

          <div style="font-size:0.8rem; padding-top:5mm">
            {% if order.paid == True %}
              <p>
                {% if order.get_total_cost == 0 and order.credit_used != 0 %}
                  <span style="color:green">Your account credit has covered the cost of this invoice.</span>
                {% else %}
                Invoice paid.
                {% endif %}
                Prices include shipping to {{ library }} Only. This invoice does not cover the cost of any postage from {{ library }} to any other location.
                All prices are in NZD.
                Prices include GST.
                {{ library }} will need to confirm the avilibility of these item.
                If an item is not availible {{ library }} will refund you for the cost of those items.
                If an item is availible {{ library }} will add items to your stockpile crate from whhere you can arrange postage to your location.
              </p>
            {% else %}
              <p>
                {% if order.get_total_cost == 0 and order.credit_used != 0 %}
                  <span style="color:green">Your account credit has covered the cost of this invoice.</span>
                {% else %}
                  Please pay ${{ order.get_total_cost }} (NZD) to <strong style="color:blue">01-0804-0187544-48</strong>.
                  Name: Tristan Maxwell.
                  Reference: <strong style="color:blue">INV-{{ order.id|stringformat:"06d" }}</strong>.
                {% endif %}
                Prices include shipping to {{ library }} Only. This invoice does not cover the cost of any postage from {{ library }} to any other location.
                All prices are in NZD.
                Prices include GST.
                Orders will be made once invoice is paid.
                {{ library }} will need to confirm the avilibility of these item.
                If an item is not availible, {{ library }} will credit your account to the value of those items.
                <br><br>
                Please note that this bank account is only temporary and it will change once I get a business account set up.
              </p>
            {% endif %}
          </div>
        </div>
      </span>
    </div>
  </body>
</html>